{% extends "bw_components/layouts/table_list_base.html" %}

{% load i18n %}

{% load core_tags %}
{% load general_report_tags %}

{# Start Table Header #}
{% block header_title %}
    {% translate header_title %}
{% endblock header_title %}
{# End Table Header #}
{# Start Table Subtitle #}
{% block header_subtitle %}
    {% translate header_subtitle %}
{% endblock header_subtitle %}
{# End Table Subtitle #}
{# Start Table ID Block #}
{% block table_id_block %}
    {{ app_label|add:'_table' }}
{% endblock table_id_block %}
{# End Table ID Block #}
{# Start Custom Css Class #}
{% block custom_css_class_name %}
    client-jobs-report-table-list
{% endblock custom_css_class_name %}
{# End Custom Css Class #}
{% if is_show_create_btn is True %}
    {# Start Create Button Block #}
    {% block create_btn_block %}
        {% component "tl_create_btn" app_name=app_label actions_base_url=actions_base_url %}
    {% endblock create_btn_block %}
    {# End Create Button Block #}
{% endif %}
{# Start Table Header Columns #}
{% block thead_block %}
    <tr>
        {% if is_checkbox_enabled is True %}
            <th scope="col" class="pl-6 py-3 text-left">
                <label for="{{ column|add:'-checkbox' }}" class="flex">
                    <input type="checkbox"
                           class="shrink-0 border-gray-200 rounded text-blue-600 pointer-events-none focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 dark:checked:bg-blue-500 dark:checked:border-blue-500 dark:focus:ring-offset-gray-800 {{ BW_DISABLED_DISABLED_INPUTS_CSS_CLASSES }} {{ BW_BASE_INPUT_CSS_CLASSES }}"
                           id="{{ column|add:'-checkbox' }}"
                           disabled />
                    <span class="sr-only">{{ column|title }}</span>
                </label>
            </th>
        {% endif %}
        <th scope="col" class="px-6 py-3 text-left" width="1%">
            <div class="flex items-center gap-x-2">
                <span class="text-xs font-semibold uppercase tracking-wide text-gray-800 dark:text-gray-200">
                    {% translate "Client Name" %}
                </span>

                {% include "bw_components/global/table_list/sort_icon.html" %}

            </div>
        </th>
        {% for month in months_list %}
            <th scope="col" class="px-6 py-3 text-left disable-sort" width="15%">
                <div class="flex items-center gap-x-2">
                    <span class="text-xs font-semibold uppercase tracking-wide text-gray-800 dark:text-gray-200">
                        {{ month|get_month_abbrev }} - {{ created_year }}
                    </span>
                    {# {% include "bw_components/global/table_list/sort_icon.html" %} #}
                </div>
            </th>
        {% endfor %}
        {% if is_show_created_at is True %}
            <th scope="col" class="px-6 py-3 text-left">
                <div class="flex items-center gap-x-2">
                    <span class="text-xs font-semibold uppercase tracking-wide text-gray-800 dark:text-gray-200">
                        {% translate "Created" %}
                    </span>
                    {# {% include "bw_components/global/table_list/sort_icon.html" %} #}
                </div>
            </th>
        {% endif %}
        <th scope="col" class="px-6 py-3 text-left disable-sort" width="1%">
            <div class="flex items-center gap-x-2"></div>
        </th>
    </tr>
{% endblock thead_block %}
{# End Table Header Columns #}
{# Start Table Body #}
{% block tbody_block %}
    {% for object in object_list.object_list %}
    {% comment  %}
        {% print created_year %}
    {% print object.organize_jobs_years_months %}
    {% endcomment %}
        <tr>
            {% if is_checkbox_enabled is True %}
                <td class="h-px w-px whitespace-nowrap">
                    <div class="pl-6 py-3">
                        <label for="{{ object.pk|add:'-checkbox' }}" class="flex">
                            <input type="checkbox"
                                   class="shrink-0 border-gray-200 rounded text-blue-600 pointer-events-none focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 dark:checked:bg-blue-500 dark:checked:border-blue-500 dark:focus:ring-offset-gray-800 {{ BW_DISABLED_DISABLED_INPUTS_CSS_CLASSES }} {{ BW_BASE_INPUT_CSS_CLASSES }}"
                                   id="{{ object.pk|add:'-checkbox' }}"
                                   disabled />
                            <span class="sr-only">{{ object.title|title }}</span>
                        </label>
                    </div>
                </td>
            {% endif %}
            <td class="h-px w-px whitespace-nowrap">
                <div class="px-6 py-3">
                    <a href="{# {% url base_url_name|add:':details' object.client.pk %} #}">
                        <span class="text-sm text-gray-600 dark:text-gray-400">{{ object.client.name|bw_truncate_titles }}</span>
                    </a>
                    {% if object.client.categories.all %}
                        <div class="my-1 text-left">
                            {% for category in object.client.categories.all %}
                                <div class="hs-tooltip inline-block mr-0.5">
                                    <a href="#" class="hs-tooltip-toggle">
                                        <span class="inline-flex items-center gap-1 py-0.5 px-2 rounded-full text-[10px] font-medium bg-blue-100 text-blue-800">{{ category.name }}</span>
                                        <span class="hs-tooltip-content hs-tooltip-shown:opacity-100 hs-tooltip-shown:visible opacity-0 transition-opacity inline-block absolute invisible z-10 py-1 px-2 bg-gray-900 text-xs font-medium text-white rounded-md shadow-sm dark:bg-slate-700"
                                              role="tooltip">{% translate "Category" %}</span>
                                    </a>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            </td>
            {% for month in months_list %}
                <td class="h-px w-px whitespace-nowrap">
                    {% extract_jobs_by_years object created_year as extracted_jobs %}
                    {% extract_months_from_jobs extracted_jobs as extracted_months %}
                    {# {% print extracted_months %} #}
                    {# {% print extracted_jobs %} #}
                    {% if month in extracted_months %}
                        {% extract_job_from_month extracted_jobs month as job_dict %}
                        <div class="px-6 py-3">
                            {# Start Completed #}
                            <div class="block">
                                <span class="inline-flex items-center gap-1.5 py-0.5 px-2 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
                                    <span class="inline-flex items-center py-0.5 px-1.5 rounded-full text-xs font-medium bg-green-800 text-white">{{ job_dict.job_completed_count }}</span>
                                    {% translate "Completed" %}
                                </span>
                            </div>
                            {# End Completed #}
                            {# Start In progress #}
                            <div class="block my-1">
                                <span class="inline-flex items-center gap-1.5 py-0.5 px-2 rounded-full text-xs font-medium bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200">
                                    <span class="inline-flex items-center py-0.5 px-1.5 rounded-full text-xs font-medium bg-yellow-800 text-white">{{ job_dict.job_in_progress_count }}</span>
                                    {% translate "In progress" %}
                                </span>
                            </div>
                            {# End In progress #}
                            {# Start Past due #}
                            <div class="block">
                                <span class="inline-flex items-center gap-1.5 py-0.5 px-2 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200">
                                    <span class="inline-flex items-center py-0.5 px-1.5 rounded-full text-xs font-medium bg-red-800 text-white">{{ job_dict.job_past_due_count }}</span>
                                    {% translate "Past due" %}
                                </span>
                            </div>
                            {# End Past due #}
                        </div>
                    {% else %}
                        <div class="hs-tooltip inline-block flex flex-auto flex-col justify-center items-center my-7">
                            <span class="hs-tooltip-toggle inline-flex justify-center items-center w-[46px] h-[46px] rounded-full bg-transparent text-white">
                                <svg class="max-w-[5rem]"
                                     viewBox="0 0 375 428"
                                     fill="none"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path d="M254.509 253.872L226.509 226.872" class="stroke-gray-400 dark:stroke-white" stroke="currentColor" stroke-width="7" stroke-linecap="round" />
                                    <path d="M237.219 54.3721C254.387 76.4666 264.609 104.226 264.609 134.372C264.609 206.445 206.182 264.872 134.109 264.872C62.0355 264.872 3.60864 206.445 3.60864 134.372C3.60864 62.2989 62.0355 3.87207 134.109 3.87207C160.463 3.87207 184.993 11.6844 205.509 25.1196" class="stroke-gray-400 dark:stroke-white" stroke="currentColor" stroke-width="7" stroke-linecap="round" />
                                    <rect x="270.524" y="221.872" width="137.404" height="73.2425" rx="36.6212" transform="rotate(40.8596 270.524 221.872)" class="fill-gray-400 dark:fill-white" fill="currentColor" />
                                    <ellipse cx="133.109" cy="404.372" rx="121.5" ry="23.5" class="fill-gray-400 dark:fill-white" fill="currentColor" />
                                    <path d="M111.608 188.872C120.959 177.043 141.18 171.616 156.608 188.872" class="stroke-gray-400 dark:stroke-white" stroke="currentColor" stroke-width="7" stroke-linecap="round" />
                                    <ellipse cx="96.6084" cy="116.872" rx="9" ry="12" class="fill-gray-400 dark:fill-white" fill="currentColor" />
                                    <ellipse cx="172.608" cy="117.872" rx="9" ry="12" class="fill-gray-400 dark:fill-white" fill="currentColor" />
                                    <path d="M194.339 147.588C189.547 148.866 189.114 142.999 189.728 138.038C189.918 136.501 191.738 135.958 192.749 137.131C196.12 141.047 199.165 146.301 194.339 147.588Z" class="fill-gray-400 dark:fill-white" fill="currentColor" />
                                </svg>
                                <span class="{{ BW_PRELINE_SPAN_TOOLTIP_CSS_CLASSES }}" role="tooltip">{% translate "No jobs in " %} {{ month|get_month_abbrev }}, {{ created_year }}</span>
                            </span>
                        </div>
                    {% endif %}
                </td>
            {% endfor %}
            {% if is_show_created_at is True %}
                <td class="h-px w-px whitespace-nowrap">
                    {% bw_date date_txt=object.created_at is_in_table_list=True %}
                </td>
            {% endif %}
            <td class="h-px w-px whitespace-nowrap text-center">
                {% if is_actions_menu_enabled is True %}
                    {% bw_actions_dropdown actions_items=actions_items actions_base_url=actions_base_url actions_app_name=actions_app_name object=object %}
                {% endif %}
            </td>
        </tr>
    {% endfor %}
{% endblock tbody_block %}
{# End Table Body #}
{# Start Table Results #}
{% block results_block %}
    {{ object_list.total_rows_count }}
{% endblock results_block %}
{# End Table Results #}
{# Start Table Pagination #}
{% block pagination_block %}

    {% include "components/inc/dashboard/table_list/table_list_pagination.html" with page_obj=object_list.page_obj pagination_list_url_name=pagination_list_url_name %}

{% endblock pagination_block %}
{# End Table Pagination #}
